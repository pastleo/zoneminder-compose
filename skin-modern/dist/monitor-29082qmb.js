import"/skins/modern/dist/main-3sctwwy9.js";function M(t){let e=["B","KB","MB","GB","TB"],o=0;while(t>=1024&&o<e.length-1)t/=1024,o++;return t.toFixed(1)+" "+e[o]}function I(t){let e=t.form;if(!e)return;let o=window.ZM_DEFAULT_ASPECT_RATIO||"4:3",a=parseInt(o.replace(/:.*$/,"")),i=parseInt(o.replace(/^.*:/,"")),r=e.elements.namedItem("newMonitor[Width]"),u=e.elements.namedItem("newMonitor[Height]"),m=e.elements.namedItem("preserveAspectRatio"),s=e.elements.namedItem("dimensions_select");if(!r||!u)return;if(t instanceof HTMLInputElement&&t.type==="number"){let d=parseInt(r.value)||0,f=parseInt(u.value)||0;if(m?.checked){if(t.name==="newMonitor[Width]"){if(d>=0)u.value=String(Math.round(d*i/a));else u.value="";f=parseInt(u.value)||0}else if(t.name==="newMonitor[Height]"){if(f>=0)r.value=String(Math.round(f*a/i));else r.value="";d=parseInt(r.value)||0}}if(s){let n=s.querySelector(`option[value="${d}x${f}"]`);s.value=n?`${d}x${f}`:""}}else if(s){let d=s.value;if(d!==""){let f=d.split("x");r.value=f[0]||"",u.value=f[1]||""}}v()}function v(){let t=document.querySelector('input[name="newMonitor[Width]"]'),e=document.querySelector('input[name="newMonitor[Height]"]'),o=document.querySelector('select[name="newMonitor[Colours]"]'),a=document.querySelector('input[name="newMonitor[ImageBufferCount]"]'),i=document.getElementById("newMonitor[PreEventCount]"),r=document.getElementById("newMonitor[MaxImageBufferCount]"),u=document.getElementById("estimated_ram_use");if(!t||!e||!u)return;let m=parseInt(t.value)||0,s=parseInt(e.value)||0,d=parseInt(o?.value||"3"),f=parseInt(a?.value||"0");f+=parseInt(i?.value||"0");let n=f*m*s*d,l="Min: "+M(n),c=parseInt(r?.value||"0");if(c){let p=(f+c)*m*s*d;l+=" Max: "+M(p)}else l+=" Max: Unlimited";u.textContent=l}function E(){let t=document.getElementById("newMonitor[MaxImageBufferCount]"),e=document.getElementById("newMonitor[PreEventCount]");if(!t||!e)return;if(parseInt(e.value)>parseInt(t.value))if(this.id==="newMonitor[PreEventCount]")t.value=e.value;else e.value=t.value;v()}function g(){let t=document.querySelector('select[name="newMonitor[Function]"]');if(!t)return;let e=t.value,o=document.getElementById("FunctionEnabled"),a=document.getElementById("FunctionDecodingEnabled"),i=document.getElementById("function_help");if(i){i.querySelectorAll("div").forEach((u)=>u.classList.add("hidden"));let r=document.getElementById(e+"Help");if(r)r.classList.remove("hidden")}if(o)if(e==="Monitor"||e==="None")o.classList.add("hidden");else o.classList.remove("hidden");if(a)if(e==="Record"||e==="Nodect")a.classList.remove("hidden");else a.classList.add("hidden")}function h(){let t=document.querySelector('select[name="newMonitor[VideoWriter]"]');if(!t)return;let e=t.value,o=document.querySelector(".OutputCodec"),a=document.querySelector(".Encoder");if(e==="1")o?.classList.remove("hidden"),a?.classList.remove("hidden");else o?.classList.add("hidden"),a?.classList.add("hidden")}function L(){let t=document.querySelector('select[name="newMonitor[OutputCodec]"]'),e=document.querySelector('select[name="newMonitor[Encoder]"]');if(!t||!e)return;let o=t.value;for(let a=0;a<e.options.length;a++){let i=e.options[a];if(!i)continue;if(o==="27")i.disabled=!i.value.includes("264");else if(o==="173")i.disabled=!(i.value.includes("hevc")||i.value.includes("265"));else if(o==="226")i.disabled=!i.value.includes("av1");else i.disabled=!1;if(i.disabled&&i.selected){let r=e.options[0];if(r)r.selected=!0;i.selected=!1}}}function S(){let t=document.querySelector('input[name="newMonitor[WebColour]"]'),e=document.getElementById("WebSwatch");if(t&&e)e.style.backgroundColor=t.value}function T(){let e="#";for(let i=0;i<6;i++)e+="0123456789ABCDEF"[Math.floor(Math.random()*16)];let o=document.querySelector('input[name="newMonitor[WebColour]"]'),a=document.getElementById("WebSwatch");if(o)o.value=e;if(a)a.style.backgroundColor=e}function y(){if("geolocation"in navigator)navigator.geolocation.getCurrentPosition((t)=>{let e=document.getElementById("contentForm");if(!e)return;let o=e.elements.namedItem("newMonitor[Latitude]"),a=e.elements.namedItem("newMonitor[Longitude]");if(o)o.value=String(t.coords.latitude);if(a)a.value=String(t.coords.longitude)});else console.log("Geolocation not available")}function w(){let t=document.getElementById("contentForm");if(!t)return!1;let e=[],o=[],a=t.elements;for(let m=0;m<a.length;m++){let s=a[m];if(s.nodeName!=="SELECT"&&s.value)s.value=s.value.trim()}let i=t.elements.namedItem("newMonitor[Name]");if(i){if(i.value.search(/[^\w\-\.\(\)\:\/ ]/)>=0)e.push("Monitor name contains invalid characters");else if(window.monitorNames?.[i.value])e.push("A monitor with this name already exists")}let r=t.elements.namedItem("newMonitor[Type]");if(r&&r.value!=="WebSite"){let m=t.elements.namedItem("newMonitor[AnalysisFPSLimit]");if(m?.value&&!(parseFloat(m.value)>0))e.push("Invalid Analysis FPS value");let s=t.elements.namedItem("newMonitor[MaxFPS]");if(s?.value&&!(parseFloat(s.value)>0))e.push("Invalid Maximum FPS value");let d=t.elements.namedItem("newMonitor[AlarmMaxFPS]");if(d?.value&&!(parseFloat(d.value)>0))e.push("Invalid Alarm Maximum FPS value")}if(e.length)return alert(e.join(`
`)),!1;if(o.length){if(!confirm(o.join(`
`)))return!1}let u=t.elements.namedItem("action");if(u)u.value="save";return t.submit(),!0}function B(){let t=document.getElementById("contentForm");if(!t)return;t.addEventListener("keyup",(n)=>{if(n.key==="Enter")n.preventDefault()}),document.querySelectorAll('input[name="newMonitor[SignalCheckColour]"]').forEach((n)=>{n.addEventListener("input",(l)=>{let c=document.getElementById("SignalCheckSwatch");if(c)c.style.backgroundColor=l.target.value})}),document.querySelectorAll('input[name="newMonitor[WebColour]"]').forEach((n)=>{n.addEventListener("input",(l)=>{let c=document.getElementById("WebSwatch");if(c)c.style.backgroundColor=l.target.value}),n.addEventListener("change",S)}),document.querySelectorAll('input[name="newMonitor[MaxFPS]"]').forEach((n)=>{let l=(c)=>{let p=document.getElementById("newMonitor[MaxFPS]");if(p)p.classList.toggle("hidden",!c.target.value)};n.addEventListener("input",l),n.addEventListener("click",l)}),document.querySelectorAll('input[name="newMonitor[AlarmMaxFPS]"]').forEach((n)=>{let l=(c)=>{let p=document.getElementById("newMonitor[AlarmMaxFPS]");if(p)p.classList.toggle("hidden",!c.target.value)};n.addEventListener("input",l),n.addEventListener("click",l)}),document.querySelectorAll('input[name="newMonitor[Width]"], input[name="newMonitor[Height]"]').forEach((n)=>{n.addEventListener("input",()=>I(n))}),document.querySelectorAll('select[name="dimensions_select"]').forEach((n)=>{n.addEventListener("change",()=>I(n))}),document.querySelectorAll('select[name="newMonitor[Type]"]').forEach((n)=>{n.addEventListener("change",()=>{let l=t.elements.namedItem("tab");if(l)l.value="general";t.submit()})}),document.querySelectorAll('input[name="newMonitor[ImageBufferCount]"], input[name="newMonitor[Width]"], input[name="newMonitor[Height]"]').forEach((n)=>{n.addEventListener("input",E.bind(n))});let e=document.getElementById("newMonitor[MaxImageBufferCount]"),o=document.getElementById("newMonitor[PreEventCount]");if(e)e.addEventListener("input",E.bind(e));if(o)o.addEventListener("input",E.bind(o));document.querySelectorAll('select[name="newMonitor[Function]"]').forEach((n)=>{n.addEventListener("change",g)}),g(),document.querySelectorAll('select[name="newMonitor[VideoWriter]"]').forEach((n)=>{n.addEventListener("change",h)}),h(),document.querySelectorAll('select[name="newMonitor[OutputCodec]"]').forEach((n)=>{n.addEventListener("change",L)}),L();let a=document.getElementById("probeBtn"),i=document.getElementById("probeBtnMobile");[a,i].forEach((n)=>{n?.addEventListener("click",(l)=>{l.preventDefault();let c=l.currentTarget.getAttribute("data-mid")||"";window.location.assign("?view=monitorprobe&mid="+c)})});let r=document.getElementById("onvifBtn"),u=document.getElementById("onvifBtnMobile");[r,u].forEach((n)=>{n?.addEventListener("click",(l)=>{l.preventDefault();let c=l.currentTarget.getAttribute("data-mid")||"";window.location.assign("?view=onvifprobe&mid="+c)})});let m=document.getElementById("presetBtn"),s=document.getElementById("presetBtnMobile");[m,s].forEach((n)=>{n?.addEventListener("click",(l)=>{l.preventDefault();let c=l.currentTarget.getAttribute("data-mid")||"";window.location.assign("?view=monitorpreset&mid="+c)})}),document.getElementById("cancelBtn")?.addEventListener("click",(n)=>{n.preventDefault(),window.location.assign("?view=console")}),document.getElementById("saveBtn")?.addEventListener("click",(n)=>{n.preventDefault(),w()}),v(),window.validateForm=w,window.random_WebColour=T,window.getLocation=y}export{B as init};
