import"/skins/modern/dist/main-3sctwwy9.js";function M(t){let e=["B","KB","MB","GB","TB"],o=0;while(t>=1024&&o<e.length-1)t/=1024,o++;return t.toFixed(1)+" "+e[o]}function I(t){let e=t.form;if(!e)return;let o=window.ZM_DEFAULT_ASPECT_RATIO||"4:3",i=parseInt(o.replace(/:.*$/,"")),a=parseInt(o.replace(/^.*:/,"")),s=e.elements.namedItem("newMonitor[Width]"),u=e.elements.namedItem("newMonitor[Height]"),m=e.elements.namedItem("preserveAspectRatio"),r=e.elements.namedItem("dimensions_select");if(!s||!u)return;if(t instanceof HTMLInputElement&&t.type==="number"){let d=parseInt(s.value)||0,E=parseInt(u.value)||0;if(m?.checked){if(t.name==="newMonitor[Width]"){if(d>=0)u.value=String(Math.round(d*a/i));else u.value="";E=parseInt(u.value)||0}else if(t.name==="newMonitor[Height]"){if(E>=0)s.value=String(Math.round(E*i/a));else s.value="";d=parseInt(s.value)||0}}if(r){let n=r.querySelector(`option[value="${d}x${E}"]`);r.value=n?`${d}x${E}`:""}}else if(r){let d=r.value;if(d!==""){let E=d.split("x");s.value=E[0]||"",u.value=E[1]||""}}v()}function v(){let t=document.querySelector('input[name="newMonitor[Width]"]'),e=document.querySelector('input[name="newMonitor[Height]"]'),o=document.querySelector('select[name="newMonitor[Colours]"]'),i=document.querySelector('input[name="newMonitor[ImageBufferCount]"]'),a=document.getElementById("newMonitor[PreEventCount]"),s=document.getElementById("newMonitor[MaxImageBufferCount]"),u=document.getElementById("estimated_ram_use");if(!t||!e||!u)return;let m=parseInt(t.value)||0,r=parseInt(e.value)||0,d=parseInt(o?.value||"3"),E=parseInt(i?.value||"0");E+=parseInt(a?.value||"0");let n=E*m*r*d,l="Min: "+M(n),c=parseInt(s?.value||"0");if(c){let p=(E+c)*m*r*d;l+=" Max: "+M(p)}else l+=" Max: Unlimited";u.textContent=l}function f(){let t=document.getElementById("newMonitor[MaxImageBufferCount]"),e=document.getElementById("newMonitor[PreEventCount]");if(!t||!e)return;if(parseInt(e.value)>parseInt(t.value))if(this.id==="newMonitor[PreEventCount]")t.value=e.value;else e.value=t.value;v()}function g(){let t=document.querySelector('select[name="newMonitor[Function]"]');if(!t)return;let e=t.value,o=document.getElementById("FunctionEnabled"),i=document.getElementById("FunctionDecodingEnabled"),a=document.getElementById("function_help");if(a){a.querySelectorAll("div").forEach((u)=>u.classList.add("hidden"));let s=document.getElementById(e+"Help");if(s)s.classList.remove("hidden")}if(o)if(e==="Monitor"||e==="None")o.classList.add("hidden");else o.classList.remove("hidden");if(i)if(e==="Record"||e==="Nodect")i.classList.remove("hidden");else i.classList.add("hidden")}function L(){let t=document.querySelector('select[name="newMonitor[VideoWriter]"]');if(!t)return;let e=t.value,o=document.querySelector(".OutputCodec"),i=document.querySelector(".Encoder");if(e==="1")o?.classList.remove("hidden"),i?.classList.remove("hidden");else o?.classList.add("hidden"),i?.classList.add("hidden")}function h(){let t=document.querySelector('select[name="newMonitor[OutputCodec]"]'),e=document.querySelector('select[name="newMonitor[Encoder]"]');if(!t||!e)return;let o=t.value;for(let i=0;i<e.options.length;i++){let a=e.options[i];if(!a)continue;if(o==="27")a.disabled=!a.value.includes("264");else if(o==="173")a.disabled=!(a.value.includes("hevc")||a.value.includes("265"));else if(o==="226")a.disabled=!a.value.includes("av1");else a.disabled=!1;if(a.disabled&&a.selected){let s=e.options[0];if(s)s.selected=!0;a.selected=!1}}}function S(){let t=document.querySelector('input[name="newMonitor[WebColour]"]'),e=document.getElementById("WebSwatch");if(t&&e)e.style.backgroundColor=t.value}function T(){let e="#";for(let a=0;a<6;a++)e+="0123456789ABCDEF"[Math.floor(Math.random()*16)];let o=document.querySelector('input[name="newMonitor[WebColour]"]'),i=document.getElementById("WebSwatch");if(o)o.value=e;if(i)i.style.backgroundColor=e}function y(){if("geolocation"in navigator)navigator.geolocation.getCurrentPosition((t)=>{let e=document.getElementById("contentForm");if(!e)return;let o=e.elements.namedItem("newMonitor[Latitude]"),i=e.elements.namedItem("newMonitor[Longitude]");if(o)o.value=String(t.coords.latitude);if(i)i.value=String(t.coords.longitude)});else console.log("Geolocation not available")}function w(){let t=document.getElementById("contentForm");if(!t)return!1;let e=[],o=[],i=t.elements;for(let m=0;m<i.length;m++){let r=i[m];if(r.nodeName!=="SELECT"&&r.value)r.value=r.value.trim()}let a=t.elements.namedItem("newMonitor[Name]");if(a){if(a.value.search(/[^\w\-\.\(\)\:\/ ]/)>=0)e.push("Monitor name contains invalid characters");else if(window.monitorNames?.[a.value])e.push("A monitor with this name already exists")}let s=t.elements.namedItem("newMonitor[Type]");if(s&&s.value!=="WebSite"){let m=t.elements.namedItem("newMonitor[AnalysisFPSLimit]");if(m?.value&&!(parseFloat(m.value)>0))e.push("Invalid Analysis FPS value");let r=t.elements.namedItem("newMonitor[MaxFPS]");if(r?.value&&!(parseFloat(r.value)>0))e.push("Invalid Maximum FPS value");let d=t.elements.namedItem("newMonitor[AlarmMaxFPS]");if(d?.value&&!(parseFloat(d.value)>0))e.push("Invalid Alarm Maximum FPS value")}if(e.length)return alert(e.join(`
`)),!1;if(o.length){if(!confirm(o.join(`
`)))return!1}let u=t.elements.namedItem("action");if(u)u.value="save";return t.submit(),!0}function B(){let t=document.getElementById("contentForm");if(!t)return;t.addEventListener("keyup",(n)=>{if(n.key==="Enter")n.preventDefault()}),document.querySelectorAll('input[name="newMonitor[SignalCheckColour]"]').forEach((n)=>{n.addEventListener("input",(l)=>{let c=document.getElementById("SignalCheckSwatch");if(c)c.style.backgroundColor=l.target.value})}),document.querySelectorAll('input[name="newMonitor[WebColour]"]').forEach((n)=>{n.addEventListener("input",(l)=>{let c=document.getElementById("WebSwatch");if(c)c.style.backgroundColor=l.target.value}),n.addEventListener("change",S)}),document.querySelectorAll('input[name="newMonitor[MaxFPS]"]').forEach((n)=>{let l=(c)=>{let p=document.getElementById("newMonitor[MaxFPS]");if(p)p.classList.toggle("hidden",!c.target.value)};n.addEventListener("input",l),n.addEventListener("click",l)}),document.querySelectorAll('input[name="newMonitor[AlarmMaxFPS]"]').forEach((n)=>{let l=(c)=>{let p=document.getElementById("newMonitor[AlarmMaxFPS]");if(p)p.classList.toggle("hidden",!c.target.value)};n.addEventListener("input",l),n.addEventListener("click",l)}),document.querySelectorAll('input[name="newMonitor[Width]"], input[name="newMonitor[Height]"]').forEach((n)=>{n.addEventListener("input",()=>I(n))}),document.querySelectorAll('select[name="dimensions_select"]').forEach((n)=>{n.addEventListener("change",()=>I(n))}),document.querySelectorAll('select[name="newMonitor[Type]"]').forEach((n)=>{n.addEventListener("change",()=>{let l=t.elements.namedItem("tab");if(l)l.value="general";t.submit()})}),document.querySelectorAll('input[name="newMonitor[ImageBufferCount]"], input[name="newMonitor[Width]"], input[name="newMonitor[Height]"]').forEach((n)=>{n.addEventListener("input",f.bind(n))});let e=document.getElementById("newMonitor[MaxImageBufferCount]"),o=document.getElementById("newMonitor[PreEventCount]");if(e)e.addEventListener("input",f.bind(e));if(o)o.addEventListener("input",f.bind(o));document.querySelectorAll('select[name="newMonitor[Function]"]').forEach((n)=>{n.addEventListener("change",g)}),g(),document.querySelectorAll('select[name="newMonitor[VideoWriter]"]').forEach((n)=>{n.addEventListener("change",L)}),L(),document.querySelectorAll('select[name="newMonitor[OutputCodec]"]').forEach((n)=>{n.addEventListener("change",h)}),h();let i=document.getElementById("probeBtn"),a=document.getElementById("probeBtnMobile");[i,a].forEach((n)=>{n?.addEventListener("click",(l)=>{l.preventDefault();let c=l.currentTarget.getAttribute("data-mid")||"";window.location.assign("?view=monitorprobe&mid="+c)})});let s=document.getElementById("onvifBtn"),u=document.getElementById("onvifBtnMobile");[s,u].forEach((n)=>{n?.addEventListener("click",(l)=>{l.preventDefault();let c=l.currentTarget.getAttribute("data-mid")||"";window.location.assign("?view=onvifprobe&mid="+c)})});let m=document.getElementById("presetBtn"),r=document.getElementById("presetBtnMobile");[m,r].forEach((n)=>{n?.addEventListener("click",(l)=>{l.preventDefault();let c=l.currentTarget.getAttribute("data-mid")||"";window.location.assign("?view=monitorpreset&mid="+c)})}),document.getElementById("cancelBtn")?.addEventListener("click",(n)=>{n.preventDefault(),window.location.assign("?view=console")}),document.getElementById("saveBtn")?.addEventListener("click",(n)=>{n.preventDefault(),w()}),v(),window.validateForm=w,window.random_WebColour=T,window.getLocation=y}export{B as init};
